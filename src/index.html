<!DOCTYPE HTML>

<html>
<head>
	<meta charset="utf-8">
	<title>html-vault</title>
	<meta name="viewport" content="width=device-width,initial-scale=1">
	<meta name="description" content="Store a secret securely in a file.">
	<meta name="keywords" content="secret, encrypt, decrypt, aes, html, share">
	<meta name="author" content="Jannis R">
	<meta name="viewport" content="width=device-width,initial-scale=1">
	<style>
body {
	margin: 0 auto; padding: 0 1em; max-width: 28em;
	font-size: 110%; font-family: "Helvetica Neue", sans-serif;
}
p { color: #333; line-height: 1.3; }
a { color: #2980b9; text-decoration: none; }
input, button, textarea {
	display: block; margin: 1em 0; box-sizing: border-box; width: 100%;
	font-size: 100%;
}
input, textarea { padding: .4em; border: 1px solid #888; border-radius: .2em; }
input.error, textarea.error { border-color: #c0392b; }
button {
	padding: .4em;
	border: none; border-radius: .2em;
	color: white; background-color: #2980b9;
	cursor: pointer;
}
button:active { background-color: #1970a9; }
button.error { background-color: #c0392b; }
textarea { min-height: 7em; font-family: "Helvetica Neue", sans-serif; }

#hint {
	display: none;
	padding: .4em .5em; border-radius: .2em;
	color: white; background-color: #c0392b;
}
#notes { margin-top: 3em; color: #555; font-size: 90%; }
#notes::before { content: "*"; padding-right: .3em; }
	</style>
</head>
<body>
	<p>Using this service, you can generate a file that contains a secret. The secret can only be obtained using the password that you provided.</p>
	<p id="hint"></p>
	<textarea id="message" placeholder="Enter your secret message." name="message"></textarea>
	<input type="password" id="password" placeholder="Pick a password that is long and hard-to-guess."/>
	<p>Once you have saved the file, send it using whatever tool you want. Remember to transmit the password separately.<a href="#notes">*</a></p>
	<button id="submit">Encrypt my secret</button>
	<p id="notes">The encryption is only as secure as the weakest link in the chain. Don't send the file and password over the same channel. If you're serious about security, don't send the password at all, but give it to the receiver manually.</p>
	<script>{{downloadjs}}</script>
	<script>{{sjcl}}</script>
	<script>
var bundle = '{{bundle-html}}'
if (bundle.length === 0 || bundle.substring(2, 16) === 'bundle-html')
	showError(form.submit, 'An error occured.')
bundle = decodeURIComponent(bundle)
	</script>
	<script>
var form = {
	message: document.getElementById('message'),
	password: document.getElementById('password'),
	submit: document.getElementById('submit')
}
var hint = document.getElementById('hint')

var resetForm = function () {
	form.message.classList.remove('error')
	form.password.classList.remove('error')
	form.submit.classList.remove('error')
	hint.style.display = 'none'
}
var showError = function (element, message) {
	element.classList.add('error')
	hint.innerHTML = message
	hint.style.display = 'block'
}

form.submit.addEventListener('click', function () {
	resetForm()

	if (form.message.value.length === 0)
		return showError(form.message, 'Please enter a message.')
	if (form.password.value.length === 0)
		return showError(form.password, 'Please enter a password.')

	try { encrypted = sjcl.encrypt(form.password.value, form.message.value) }
	catch (error) { return showError(form.submit, 'An error occured.') }

	html = bundle.replace('{{encrypted-text}}', encrypted)
	download(html, 'secret.html', 'text/html')
	form.password.value = ''
}, false)
	</script>
</body>
</html>
