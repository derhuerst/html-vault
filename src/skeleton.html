<!DOCTYPE HTML>

<html>
<head>
	<title>secret</title>
	<meta charset="utf-8">
	<meta name="viewport" content="width=device-width,initial-scale=1">
	<style>
body {
	margin: 0 auto; padding: 0 1em; max-width: 28em;
	font-size: 110%; font-family: "Helvetica Neue", sans-serif;
}
p { color: #333; line-height: 1.3; }
a { color: #2980b9; text-decoration: none; }
input, button, textarea {
	display: block; margin: 1em 0; box-sizing: border-box; width: 100%;
	font-size: 100%;
}
input, textarea { padding: .4em; border: 1px solid #888; border-radius: .2em; }
input.error, textarea.error { border-color: #c0392b; }
button {
	padding: .4em;
	border: none; border-radius: .2em;
	color: white; background-color: #2980b9;
	cursor: pointer;
}
button:active { background-color: #1970a9; }
button.error { background-color: #c0392b; }
textarea { min-height: 7em; font-family: "Helvetica Neue", sans-serif; }
pre {
	padding: .6em;
	color: #333; background-color: #eee;
	border-radius: .2em;
	word-wrap: auto; white-space: pre-wrap;
}

#hint {
	display: none;
	padding: .4em .5em; border-radius: .2em;
	color: white; background-color: #c0392b;
}
	</style>
</head>
<body>
	<p>This file contains an encrypted message.</p>
	<p id="hint"></p>
	<input type="password" id="password" placeholder="Enter the password."/>
	<button id="submit">Decrypt the secret</button>
	<pre id="message"></pre>
	<script>{{sjcl}}</script>
	<script>
var encrypted = '{{encrypted-text}}'
if (encrypted.length === 0 || encrypted.substring(2, 16) === 'encrypted-text')
	showError(form.submit, 'An error occured.')
	</script>
	<script>
var form = {
	password: document.getElementById('password'),
	submit: document.getElementById('submit'),
	message: document.getElementById('message')
}
var hint = document.getElementById('hint')

var resetForm = function () {
	form.password.classList.remove('error')
	form.submit.classList.remove('error')
	hint.style.display = 'none'
}
var showError = function (element, message) {
	element.classList.add('error')
	hint.innerHTML = message
	hint.style.display = 'block'
}

form.submit.addEventListener('click', function () {
	resetForm()

	if (form.password.value.length === 0)
		return showError(form.password, 'Please enter a password.')

	try { decrypted = sjcl.decrypt(form.password.value, encrypted) }
	catch (error) { return showError(form.submit, 'The password seems to be wrong.') }

	form.message.innerHTML = decrypted
	form.password.value = ''
}, false)
	</script>
</body>
</html>
